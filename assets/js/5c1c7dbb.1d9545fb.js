"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[748],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>d});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),l=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=l(n),m=r,d=u["".concat(c,".").concat(m)]||u[m]||h[m]||i;return n?a.createElement(d,o(o({ref:t},p),{},{components:n})):a.createElement(d,o({ref:t},p))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[u]="string"==typeof e?e:r,o[1]=s;for(var l=2;l<i;l++)o[l]=n[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9443:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var a=n(7462),r=(n(7294),n(3905));const i={sidebar_position:7},o="Custom Chains",s={unversionedId:"chain-basics/custom_chains",id:"chain-basics/custom_chains",title:"Custom Chains",description:'If you have been following the guides, now you know how to create chains, how to compose them together, and everything, however, what if you want to change the core behaviour of the chain, how do you do it? Well, turns out, there are no "custom chains" really, it\'s all just composition.',source:"@site/docs/chain-basics/custom_chains.md",sourceDirName:"chain-basics",slug:"/chain-basics/custom_chains",permalink:"/litechain/docs/chain-basics/custom_chains",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/chain-basics/custom_chains.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7},sidebar:"tutorialSidebar",previous:{title:"Error Handling",permalink:"/litechain/docs/chain-basics/error_handling"},next:{title:"LLMs",permalink:"/litechain/docs/llms/"}},c={},l=[{value:"Next Steps",id:"next-steps",level:2}],p={toc:l},u="wrapper";function h(e){let{components:t,...n}=e;return(0,r.kt)(u,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"custom-chains"},"Custom Chains"),(0,r.kt)("p",null,"If you have been following the guides, now you know how to create chains, how to compose them together, and everything, however, what if you want to change the core behaviour of the chain, how do you do it? Well, turns out, ",(0,r.kt)("strong",{parentName:"p"},'there are no "custom chains" really'),", it's all just composition."),(0,r.kt)("p",null,"For example, let's say you want a chain that retries on error, using the ",(0,r.kt)("a",{parentName:"p",href:"https://pypi.org/project/retry/"},(0,r.kt)("inlineCode",{parentName:"a"},"@retry"))," library annotation, you can simply create a function that wraps the chain to be retried:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'from litechain import Chain\nfrom retry import retry\nfrom typing import TypeVar\n\nT = TypeVar("T")\nU = TypeVar("U")\n\ndef retriable(chain: Chain[T, U]) -> Chain[T, U]:\n    @retry(tries=3)\n    def call_wrapped_chain(input: T):\n        return chain(input)\n\n    return Chain[T, U]("RetriableChain", call_wrapped_chain)\n')),(0,r.kt)("p",null,"And use it like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'from litechain import collect_final_output\n\nattempts = 0\n\ndef division_by_attempts(input: int):\n    global attempts\n    attempts += 1\n    return input / (attempts - 1)\n\nchain = retriable(\n  Chain[int, float]("BrokenChain", division_by_attempts)\n).map(lambda x: x + 1)\n\nawait collect_final_output(chain(25))\n#=> [26]\n')),(0,r.kt)("p",null,"This chain will first divide by zero, causing a ",(0,r.kt)("inlineCode",{parentName:"p"},"ZeroDivisionError"),", but thanks to our little ",(0,r.kt)("inlineCode",{parentName:"p"},"retriable")," wrapper, it will try again an succeed next time, returning ",(0,r.kt)("inlineCode",{parentName:"p"},"26"),"."),(0,r.kt)("p",null,"So that's it, because chains are just input and output, a simple function will do, if you want to write a class to fit more the type system and be more pythonic, you also can, and the only method you need to override is ",(0,r.kt)("inlineCode",{parentName:"p"},"__init__"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'class RetriableChain(Chain[T, U]):\n    def __init__(self, chain: Chain[T, U], tries=3):\n        @retry(tries=tries)\n        def call_wrapped_chain(input: T):\n            return chain(input)\n\n        super().__init__("RetriableChain", call_wrapped_chain)\n')),(0,r.kt)("p",null,"This will work exactly the same as the function:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'chain = RetriableChain(\n  Chain[int, float]("BrokenChain", division_by_attempts)\n).map(lambda x: x + 1)\n\nawait collect_final_output(chain(25))\n#=> [26]\n')),(0,r.kt)("p",null,"As a proof that this is enough, take a look at ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/rogeriochaves/litechain/blob/main/litechain/contrib/llms/open_ai.py#L26"},"how the OpenAICompletionChain is implemented"),", it's a simple wrapper of OpenAI's API under ",(0,r.kt)("inlineCode",{parentName:"p"},"__init__")," and that's it."),(0,r.kt)("h2",{id:"next-steps"},"Next Steps"),(0,r.kt)("p",null,"This concludes the guides for Chain Basics, congratulations! On the next steps, we are going to build some real application with real LLMs, stay tuned!"))}h.isMDXComponent=!0}}]);